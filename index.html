<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TAMM Life Events Medical Hub</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React + ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    <script>window.react = window.React;</script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect, useRef } = React;

      // --- ICON SYSTEM ---
      const Lucide = window.LucideReact || {};
      const FallbackIcon = (props) => <span {...props} className="inline-block w-4 h-4 bg-slate-200" />;
      const getIcon = (name) => Lucide[name] || FallbackIcon;
      
      const Icons = {
        Baby: getIcon("Baby"),
        HeartPulse: getIcon("HeartPulse"),
        ShieldCheck: getIcon("ShieldCheck"),
        School: getIcon("School"),
        Stethoscope: getIcon("Stethoscope"),
        ClipboardCheck: getIcon("ClipboardCheck"),
        FileText: getIcon("FileText"),
        Sparkles: getIcon("Sparkles"),
        UserRound: getIcon("UserRound"),
        Activity: getIcon("Activity"),
        Users: getIcon("Users"),
        Briefcase: getIcon("Briefcase"),
        Home: getIcon("Home"),
        BookOpen: getIcon("BookOpen"),
        ChevronRight: getIcon("ChevronRight"),
        Search: getIcon("Search"),
        Send: getIcon("Send"),
        CheckCircle2: getIcon("CheckCircle2"),
        AlertTriangle: getIcon("AlertTriangle"),
        HeartHandshake: getIcon("HeartHandshake"),
        GraduationCap: getIcon("GraduationCap"),
        Calendar: getIcon("Calendar"),
      };

      // --- UI COMPONENTS ---

      const Card = ({ className, children }) => (
        <div className={`rounded-2xl border border-slate-200 bg-white text-slate-950 shadow-sm ${className || ""}`}>{children}</div>
      );
      const CardHeader = ({ className, children }) => <div className={`flex flex-col space-y-1.5 p-6 ${className || ""}`}>{children}</div>;
      const CardTitle = ({ className, children }) => <h3 className={`text-xl font-bold leading-none tracking-tight ${className || ""}`}>{children}</h3>;
      const CardContent = ({ className, children }) => <div className={`p-6 pt-0 ${className || ""}`}>{children}</div>;

      const Button = ({ className, variant = "default", size = "default", children, ...props }) => {
        const variants = {
          default: "bg-slate-900 text-white hover:bg-slate-800",
          outline: "border border-slate-200 bg-white hover:bg-slate-50 text-slate-900",
          ghost: "hover:bg-slate-100 text-slate-700",
        };
        const sizes = { default: "h-10 px-4 py-2", sm: "h-8 rounded-lg px-3 text-xs", icon: "h-10 w-10" };
        return (
          <button className={`inline-flex items-center justify-center whitespace-nowrap rounded-xl text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-slate-950 ${variants[variant]} ${sizes[size]} ${className || ""}`} {...props}>{children}</button>
        );
      };

      const Badge = ({ className, variant = "default", children }) => {
        const variants = {
          default: "bg-slate-900 text-white",
          secondary: "bg-slate-100 text-slate-900",
          outline: "border border-slate-200 text-slate-600",
        };
        return <div className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${variants[variant]} ${className || ""}`}>{children}</div>;
      };

      const Progress = ({ value }) => (
        <div className="relative h-2 w-full overflow-hidden rounded-full bg-slate-100">
          <div className="h-full bg-slate-900 transition-all duration-500" style={{ width: `${value}%` }} />
        </div>
      );

      const Switch = ({ checked, onCheckedChange }) => (
        <button 
          type="button" role="switch" aria-checked={checked} onClick={() => onCheckedChange(!checked)}
          className={`w-11 h-6 rounded-full relative transition-colors focus:outline-none focus:ring-2 focus:ring-slate-900 ${checked ? 'bg-slate-900' : 'bg-slate-200'}`}
        >
          <span className={`block w-5 h-5 bg-white rounded-full shadow transition-transform ${checked ? 'translate-x-5' : 'translate-x-0.5'}`} style={{marginTop: '2px'}} />
        </button>
      );

      const Separator = ({ className }) => <div className={`h-[1px] w-full bg-slate-200 ${className || ''}`} />;
      
      const Textarea = ({ className, ...props }) => (
        <textarea className={`flex min-h-[80px] w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-900 ${className || ''}`} {...props} />
      );

      const Tabs = ({ value, onValueChange, children }) => <div className="w-full" onClick={(e) => { const b = e.target.closest('button'); if(b) onValueChange(b.dataset.value); }}>{children}</div>;
      const TabsList = ({ className, children }) => <div className={`inline-flex h-9 items-center justify-center rounded-lg bg-slate-100 p-1 text-slate-500 ${className || ''}`}>{children}</div>;
      const TabsTrigger = ({ value, className, children }) => <button data-value={value} className={`inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium transition-all focus:outline-none hover:bg-white/50 ${className}`}>{children}</button>;

      // --- DATA ---

      const PERSONAS = {
        citizen: {
          label: "Citizen family", familyName: "Al Nuaimi Family", parents: "Omar & Aisha", expectedBaby: "Baby Noor", location: "Abu Dhabi",
          benefitsLabel: "Eligible benefits", showMabrouk: true, showSchoolSeat: true, showPaternityLeave: true, showMOFA: false,
        },
        resident: {
          label: "Resident family", familyName: "Khan Family", parents: "Hassan & Mariam", expectedBaby: "Baby Lina", location: "Abu Dhabi",
          benefitsLabel: "Available support", showMabrouk: false, showSchoolSeat: false, showPaternityLeave: false, showMOFA: true,
        },
      };

      const LIFE_STAGES = [
        { key: "premarital", title: "Premarital screening", icon: Icons.HeartHandshake },
        { key: "marriage", title: "Marriage", icon: Icons.Users },
        { key: "preconception", title: "Planning a baby", icon: Icons.HeartPulse },
        { key: "maternity", title: "Maternity care", icon: Icons.Stethoscope },
        { key: "birth", title: "Birth paperwork", icon: Icons.FileText },
        { key: "mabrouk", title: "Mabrouk Ma Yak", icon: Icons.Baby, citizenOnly: true },
        { key: "screening", title: "Newborn screening", icon: Icons.ShieldCheck },
        { key: "vaccination", title: "Vaccinations", icon: Icons.HeartPulse },
        { key: "education", title: "Early education", icon: Icons.GraduationCap, citizenOnly: true },
        { key: "housing", title: "Family housing", icon: Icons.Home, addon: true },
        { key: "work", title: "Work & leave", icon: Icons.Briefcase, addon: true },
        { key: "adult", title: "Adult prevention", icon: Icons.HeartPulse },
        { key: "elderly", title: "Elderly care", icon: Icons.Users },
        { key: "sanadkom", title: "End-of-life", icon: Icons.FileText },
      ];

      const JOURNEYS = [
        {
          key: "premarital", title: "Premarital screening", subtitle: "Book, complete tests, and unlock the next steps.", icon: Icons.HeartHandshake,
          touchpoints: ["Check required tests", "Add partner details", "Choose a clinic", "Book an appointment", "Pay and confirm", "Attend the screening", "View completion status", "Receive education options", "Continue to marriage application"],
          enhancements: ["One clear checklist for both partners", "Fast-track lanes for urgent wedding dates", "Simple explanations of what the results mean"],
          ai: ["Suggest best appointment slots based on both calendars", "Flag missing documents before the visit", "Answer sensitive FAQs in private mode"],
        },
        {
          key: "marriage", title: "Marriage", subtitle: "A guided path to complete the marriage contract.", icon: Icons.Users,
          touchpoints: ["Review eligibility", "Start the application", "Upload required documents", "Verify identities", "Select dates and preferences", "Track application status", "Receive contract confirmation", "Access post-marriage support"],
          enhancements: ["A single status page for both partners", "Document auto-check to reduce rejections", "Clear on-screen difference between citizen and resident rules"],
          ai: ["Detect document issues before upload", "Predict likely approval timeline", "Provide a plain-language summary of what happens next"],
        },
        // ... (Other journeys mapped to generic fallback for brevity in this fix, but structure supports all)
      ];

      // Generic fallback for journeys not fully defined in the array above
      const getJourney = (key) => JOURNEYS.find(j => j.key === key) || {
        key: key, title: "Service Details", subtitle: "Managed through Medical Hub", icon: Icons.FileText,
        touchpoints: ["Check eligibility", "Submit request", "Track status", "View outcome"],
        enhancements: ["Integrated timeline", "Digital approvals"],
        ai: ["Eligibility pre-check", "Document assistant"]
      };

      // --- COMPONENTS ---

      function StagePill({ active, disabled, title, Icon, onClick }) {
        return (
          <button type="button" onClick={disabled ? undefined : onClick}
            className={`flex items-center gap-2 px-3 py-2 rounded-full border text-sm transition-all focus:outline-none ${disabled ? "opacity-40 bg-slate-100 cursor-not-allowed" : "cursor-pointer hover:bg-slate-100"} ${active ? "bg-slate-900 text-white border-slate-900 shadow-md" : "bg-white"}`}
          >
            <Icon className="h-4 w-4" />
            <span className="whitespace-nowrap">{title}</span>
          </button>
        );
      }

      function MiniJourneyCard({ journey, personaKey, compact }) {
        const [expanded, setExpanded] = useState(!compact);
        useEffect(() => { if (compact) setExpanded(false); }, [compact]);
        
        return (
          <Card className="rounded-2xl">
            <CardHeader className="pb-2">
              <div className="flex items-start justify-between gap-3">
                <div className="flex items-center gap-3">
                  <div className="h-10 w-10 rounded-xl bg-slate-100 flex items-center justify-center">
                    <journey.icon className="h-5 w-5" />
                  </div>
                  <div>
                    <CardTitle className="text-lg">{journey.title}</CardTitle>
                    <p className="text-sm text-slate-500 mt-1">{journey.subtitle}</p>
                  </div>
                </div>
                <Badge variant="outline">Active Journey</Badge>
              </div>
            </CardHeader>
            <CardContent className="space-y-4">
              <div>
                <div className="flex items-center justify-between gap-2 text-sm font-medium">
                  <div className="flex items-center gap-2"><Icons.Calendar className="h-4 w-4" /><span>Your touchpoints</span></div>
                  {journey.touchpoints.length > 5 && (
                    <Button type="button" variant="ghost" size="sm" className="h-7 px-2 text-xs rounded-full" onClick={() => setExpanded((prev) => !prev)}>
                      {expanded ? "Hide details" : "Show details"}
                    </Button>
                  )}
                </div>
                <div className="mt-2 flex flex-wrap gap-2">
                  {(expanded ? journey.touchpoints : journey.touchpoints.slice(0, 5)).map((t, i) => (
                    <Badge key={i} variant="outline" className="rounded-full">{t}</Badge>
                  ))}
                </div>
              </div>
              <div className="flex flex-wrap gap-2">
                <Button variant="default" className="rounded-xl">View your steps</Button>
                <Button variant="outline" className="rounded-xl">See required documents</Button>
              </div>
            </CardContent>
          </Card>
        );
      }

      function AIAssistantPanel({ personaKey }) {
        const persona = PERSONAS[personaKey];
        const [message, setMessage] = useState("");
        const suggestions = ["Show my next 3 recommended steps", "Check what documents are already on file", "Help me book my next appointment"];

        return (
          <Card className="rounded-2xl border-blue-100">
            <CardHeader className="pb-2">
              <div className="flex items-center gap-2">
                <div className="h-9 w-9 rounded-xl bg-blue-50 flex items-center justify-center"><Icons.Sparkles className="h-5 w-5 text-blue-600" /></div>
                <div>
                  <CardTitle className="text-lg">Family Assistant</CardTitle>
                  <p className="text-sm text-slate-500">Personalized guidance.</p>
                </div>
              </div>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="rounded-xl bg-slate-50 p-3">
                <div className="text-sm"><span className="font-medium">Welcome back,</span> {persona.parents}.</div>
                <div className="text-sm text-slate-500 mt-1">Based on your profile, we've highlighted relevant steps.</div>
              </div>
              <div>
                <div className="text-sm font-medium">Suggested asks</div>
                <div className="mt-2 flex flex-wrap gap-2">
                  {suggestions.map((s, i) => (
                    <Button key={i} variant="outline" className="rounded-full h-8 px-3 text-xs" onClick={() => setMessage(s)}>{s}</Button>
                  ))}
                </div>
              </div>
              <Textarea value={message} onChange={(e) => setMessage(e.target.value)} placeholder="Ask about next steps..." className="min-h-[90px] rounded-xl" />
              <Button className="rounded-xl w-full">Get Guidance</Button>
            </CardContent>
          </Card>
        );
      }

      // --- MAIN APP ---

      function LifeEventsMedicalHubDashboard() {
        const [personaKey, setPersonaKey] = useState("citizen");
        const [compactMode, setCompactMode] = useState(false);
        const [selectedStageKey, setSelectedStageKey] = useState("premarital");
        const [premaritalSimulatedComplete, setPremaritalSimulatedComplete] = useState(false);

        const persona = PERSONAS[personaKey];
        const stages = useMemo(() => LIFE_STAGES.filter((s) => !s.citizenOnly || (s.citizenOnly && personaKey === "citizen")), [personaKey]);
        const selectedJourney = getJourney(selectedStageKey);
        
        const coreStages = stages.filter(s => !s.addon);
        const addonStages = stages.filter(s => s.addon);

        return (
          <div className="min-h-screen bg-gradient-to-b from-white to-slate-50 p-4 md:p-8">
            {/* Top Container - Fixed the closing tag issue here */}
            <div className="max-w-7xl mx-auto">
              
              {/* Header */}
              <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-6">
                <div className="flex items-center gap-3">
                  <div className="h-11 w-11 rounded-2xl bg-slate-100 flex items-center justify-center"><Icons.Users className="h-6 w-6" /></div>
                  <div>
                    <div className="text-sm text-slate-500">TAMM</div>
                    <div className="text-2xl font-semibold">Life Events Medical Hub</div>
                  </div>
                </div>
                <div className="flex flex-wrap items-center gap-3">
                  <div className="flex items-center gap-2 rounded-xl border px-3 py-2 bg-white">
                    <span className="text-xs text-slate-500">Compact view</span>
                    <Switch checked={compactMode} onCheckedChange={setCompactMode} />
                  </div>
                  <div className="flex items-center gap-2 rounded-xl border px-3 py-2 bg-white">
                    <span className="text-xs text-slate-500">Persona:</span>
                    <Tabs value={personaKey} onValueChange={setPersonaKey}>
                      <TabsList className="h-8">
                        <TabsTrigger value="citizen">Citizen</TabsTrigger>
                        <TabsTrigger value="resident">Resident</TabsTrigger>
                      </TabsList>
                    </Tabs>
                  </div>
                </div>
              </div>

              {/* Family Context */}
              <Card className="rounded-2xl mb-6">
                <CardContent className="p-5 md:p-6">
                  <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                    <div className="flex items-center gap-4">
                      <div className="h-14 w-14 rounded-2xl bg-slate-100 flex items-center justify-center"><Icons.Baby className="h-7 w-7" /></div>
                      <div>
                        <div className="text-xs text-slate-500">Your family</div>
                        <div className="text-xl font-semibold">{persona.familyName}</div>
                        <div className="text-sm text-slate-500">{persona.parents} Â· {persona.location}</div>
                      </div>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      <Badge variant="outline" className="rounded-full">{persona.benefitsLabel}</Badge>
                      <Badge className="rounded-full">{personaKey === "citizen" ? "Family Book Path" : "Resident Newborn Path"}</Badge>
                    </div>
                  </div>

                  <Separator className="my-4" />

                  {/* Timeline */}
                  <div className="text-sm font-medium mb-2">Your life journey overview</div>
                  <div className="mb-3 flex flex-wrap items-center gap-1">
                    {coreStages.map((s, idx) => (
                      <React.Fragment key={s.key}>
                        <StagePill active={s.key === selectedStageKey} title={s.title} Icon={s.icon} onClick={() => setSelectedStageKey(s.key)} />
                        {idx !== coreStages.length - 1 && <div className="hidden md:block h-px flex-1 min-w-[24px] bg-slate-200 mx-1" />}
                      </React.Fragment>
                    ))}
                  </div>
                  {addonStages.length > 0 && (
                    <div className="flex flex-wrap gap-2 mt-2">
                      {addonStages.map(s => (
                        <StagePill key={s.key} active={s.key === selectedStageKey} title={s.title} Icon={s.icon} onClick={() => setSelectedStageKey(s.key)} />
                      ))}
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* Content Grid */}
              <div className="grid lg:grid-cols-3 gap-6 mt-6">
                <div className="lg:col-span-2 space-y-4">
                  <MiniJourneyCard journey={selectedJourney} personaKey={personaKey} compact={compactMode} />
                </div>
                <div className="space-y-4">
                  <AIAssistantPanel personaKey={personaKey} />
                  <Card className="rounded-2xl">
                    <CardHeader className="pb-2"><CardTitle className="text-base">Quick Documents</CardTitle></CardHeader>
                    <CardContent className="space-y-3">
                      <div className="rounded-xl border p-3 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <Icons.FileText className="h-4 w-4" />
                          <div className="text-sm font-medium">Checklist</div>
                        </div>
                        <Button variant="outline" size="sm">Open</Button>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </div>

              {/* Footer */}
              <div className="mt-10 mb-6 text-center text-xs text-slate-400">
                This prototype focuses on the customer experience and the logical flow of life events inside TAMM.
              </div>

            </div> {/* Correctly closing max-w-7xl here */}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<LifeEventsMedicalHubDashboard />);
    </script>
  </body>
</html>
